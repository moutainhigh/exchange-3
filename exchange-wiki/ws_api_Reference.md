# WebSocket API Reference

在线调试地址：http://120.78.83.238:8010

开发环境接口地址：ws://120.78.83.238:8326

```
币币交易K线订阅
{
sub: 'market.btcusdt.kline.1min',
id: 'id generate by client'
}
创新交易K线订阅
{
sub: 'market.tc.btcusdt.kline.1min',
id: 'id generate by client'
}
取消订阅通道
{
cancel: 'market.tc.btcusdt.kline.1min',
id: 'id generate by client'
}
币币交易对订阅
{
sub: 'market.usdt.
ticker',
id: 'id generate by client'
}
创新交易对订阅
{
sub: 'market.ticker.tc',
id: 'id generate by client'
}
市场深度订阅
{
sub: 'market.btcusdt.depth.step0',
id: 'id generate by client'
}
实时成交订单数据订阅
{
  "sub": "market.btcusdt.trade.detail",
  "id": "id1"
}
订阅 Market Detail 数据
{
  "sub": "market.$symbol.detail",
  "id": "id generated by client"
}
币币交易订单状态更新（订阅未成交委托）
{
  "sub": "order.pending.update",
  "id": "id1"
}
订阅历史委托
{
  "sub": "order.btc.finished.update",
  "id": "id1"
}

账户资产变动
{
sub: 'position.details.update',
id: 'id generate by client'
}
创新交易订单状态更新（持仓明细）
{
sub: 'position.details.update',
id: 'id generate by client'
}
持仓汇总
{
sub: 'position.summary.update',
id: 'id generate by client'
}
今日平仓
{
sub: 'closeposition.orders.update',
id: 'id generate by client'
}
今日委托
{
sub: 'entrust.orders.update',
id: 'id generate by client'
}
今日成交
{
sub: 'turnover.orders.update',
id: 'id generate by client'
}


如果用户已登录，需把authorization字段带上
{
sub: 'market.btcusdt.kline.1min',
id: 'id generate by client',
authorization: 'Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJxaWFuZyIsInRlbCI6IjEzMzEyOTc5NTEzIiwiZXhwIjoxNTI2NjE4NDM0LCJ1c2VyX2lkIjo5OTYyODI5Nzg2MDI2NjM5MzgsImNyZWF0ZWQiOjE1MjY2MTEyMzQxNTR9.u190jgNQEm5iDVwv5nI2ICY-7-1MfW_2hiyCIn7sUMoSQxLI3lq_uLFjnY79mT5KiNbPdgxgMHmkqw4bqZMKPg'
}


```



## 订阅 KLine 数据 market.$symbol.kline.$period

成功建立和 WebSocket API 的连接之后，向 Server 发送如下格式的数据来订阅数据：


```
{
  "sub": "market.$symbol.kline.$period",
  "id": "id generate by client"
}
```

| 参数名称         | 是否必须  | 类型     | 描述                | 默认值   | 取值范围                                     |
| ------------ | ----- | ------ | ----------------- | ----- | ---------------------------------------- |
| symbol       | true  | string | 交易对                |       | ethbtc, ltcbtc, etcbtc, bchbtc...... |
| period       | true  | string | K线周期          |       | 1sec,5sec,1min, 5min, 15min, 30min, 1hour, 2hour, 4hour, 6hour, 12hour, 1day, 1week, 1mon,  1year |

**正确订阅的例子**

正确订阅
```
{
  "sub": "market.btcusdt.kline.1min",
  "id": "id1"
}
```

订阅成功返回数据的例子
```
{
  "id": "id1",
  "status": "ok",
  "subbed": "market.btcusdt.kline.1min",
  "ts": 1489474081631
}
```

之后每当 KLine 有更新时，client 会收到数据，例子
```
{
	"tick": [
		[1525799580000, 9148.9, 9153.24, 9148.2, 9148.2, 0],
		[1525799640000, 9148.2, 9149.83, 9148.2, 9149.12, 0],
	 	 ...1000
	],
	"id": "1",
	"ch": "market.btcusdt.kline.1min",
	"ts": 1526811530373
}
```

tick 说明
```
"tick": [
		[时间戳, 开, 高, 低, 收, 量],
	 	 ...1000
]

```

**错误订阅的例子**

错误订阅(错误的 symbol)
```
{
  "sub": "market.invalidsymbol.kline.1min",
  "id": "id2"
}
```

订阅失败返回数据的例子
```
{
  "id": "id2",
  "status": "error",
  "err-code": "bad-request",
  "err-msg": "invalid topic market.invalidsymbol.kline.1min",
  "ts": 1494301904959
}
```

错误订阅(错误的 topic)
```
{
  "sub": "market.btcusdt.kline.3min",
  "id": "id3"
}
```

订阅失败返回数据的例子
```
{
  "id": "id3",
  "status": "error",
  "err-code": "bad-request",
  "err-msg": "invalid topic market.btcusdt.kline.3min",
  "ts": 1494310283622
}
```

## 订阅 Market Depth 数据 market.$symbol.depth.$type 

成功建立和 WebSocket API 的连接之后，向 Server 发送如下格式的数据来订阅数据：
```
{
  "sub": "market.$symbol.depth.$type",
  "id": "id generated by client"
}
```

| 参数名称         | 是否必须  | 类型     | 描述                | 默认值   | 取值范围                                     |
| ------------ | ----- | ------ | ----------------- | ----- | ---------------------------------------- |
| symbol       | true  | string | 交易对                |       | btcusdt, ethusdt, ltcusdt, etcusdt, bchusdt, ethbtc, ltcbtc, etcbtc, bchbtc... |
| type         | true  | string | Depth 类型          |       | step0, step1, step2（合并深度0-3）；step0时，不合并深度 |

* 用户选择“合并深度”时，一定报价精度内的市场挂单将予以合并显示。合并深度仅改变显示方式，不改变实际成交价格。

正确订阅例子
```
{
  "sub": "market.btcusdt.depth.step0",
  "id": "id1"
}
```

订阅成功返回数据的例子
```
{
  "id": "id1",
  "status": "ok",
  "subbed": "market.btcusdt.depth.step0",
  "ts": 1489474081631
}
```

之后每当 depth 有更新时，client 会收到数据，例子
```
{
	"tick": {
		"cnyPrice": 64.64,
		"price": 10.1,
		"asks": [{
			"volume": 8.9199,
			"price": 10.23
		}, {
			"volume": 5.78,
			"price": 10.33
		}],
		"bids": [{
			"volume": 5.91,
			"price": 10.085
		}, {
			"volume": 3.92,
			"price": 9.89
		}]
	},
	"id": "1",
	"ch": "market.btcusdt.depth.step0",
	"ts": 1526812846181
}
```
